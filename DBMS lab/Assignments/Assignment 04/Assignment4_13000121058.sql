-- i) CREATE TABLES

-- CLIENT MASTER TABLE
CREATE TABLE CLIENT_MASTER(
CLIENT_NO VARCHAR2(6) PRIMARY KEY CHECK(CLIENT_NO LIKE 'C%'),
NAME VARCHAR2(20) NOT NULL,
CITY VARCHAR2(15),
PINCODE NUMBER(8),
STATE VARCHAR2(15),
BAL_DUE NUMBER(10,2)
);

-- PRODUCT MASTER TABLE
CREATE TABLE PRODUCT_MASTER(
PRODUCT_NO VARCHAR2(6) PRIMARY KEY CHECK(PRODUCT_NO LIKE 'P%'),
DESCRIPTION VARCHAR2(15) NOT NULL,
QTY_ON_HAND NUMBER(8) NOT NULL,
SELL_PRICE NUMBER(8,2) NOT NULL CHECK(SELL_PRICE>0),
COST_PRICE NUMBER(8,2) NOT NULL CHECK(COST_PRICE>0)
);

-- SALESMAN MASTER TABLE
CREATE TABLE SALESMAN_MASTER(
SALESMAN_NO VARCHAR2(6) PRIMARY KEY CHECK(SALESMAN_NO LIKE'S%' ),
SALESMAN_NAME VARCHAR2(20) NOT NULL,
CITY VARCHAR2(20) NOT NULL,
PINCODE NUMBER(8) NOT NULL,
STATE VARCHAR2(20) NOT NULL,
SAL_AMT NUMBER(8,2) NOT NULL
);

-- SALES ORDER TABLE
CREATE TABLE SALES_ORDER(
ORDER_NO VARCHAR2(6) PRIMARY KEY CHECK(ORDER_NO LIKE 'O%'),
CLIENT_NO VARCHAR2(6),
ORDER_DATE DATE,
SALESMAN_NO VARCHAR2(6),
DELY_TYPE CHAR(1) DEFAULT 'F',
DELY_DATE DATE,
FOREIGN KEY(CLIENT_NO) REFERENCES CLIENT_MASTER(CLIENT_NO) ON DELETE CASCADE,
FOREIGN KEY(SALESMAN_NO) REFERENCES SALESMAN_MASTER(SALESMAN_NO) ON DELETE CASCADE
);

-- SALES ORDER DETAILS
CREATE TABLE SALES_ORDER_DETAILS(
ORDER_NO VARCHAR2(6),
PRODUCT_NO VARCHAR2(6),
QTY_DISP NUMBER(8),
PRODUCT_RATE NUMBER(10,2),
FOREIGN KEY(ORDER_NO) REFERENCES SALES_ORDER(ORDER_NO) ON DELETE CASCADE,
FOREIGN KEY(PRODUCT_NO) REFERENCES PRODUCT_MASTER(PRODUCT_NO) ON DELETE CASCADE
);

-- II) INSERT 5 RECORDS 

-- INSERT INTO CLIENT MASTER
INSERT INTO CLIENT_MASTER VALUES('C1','ARKAPRATIM','KOLKATA',700059,'WEST BENGAL',1000.00);
INSERT INTO CLIENT_MASTER VALUES('C2','SOUMODEEP','MUMBAI',700002,'MAHARASHTRA',2000.00);
INSERT INTO CLIENT_MASTER VALUES('C3','DEBARGHYA','NOIDA',700078,'UTTARPRADESH',3000.00);
INSERT INTO CLIENT_MASTER VALUES('C4','PRITHWISH','KOLKATA',800059,'WEST BENGAL',4000.00);
INSERT INTO CLIENT_MASTER VALUES('C5','SAGNIK','BENGALURU',900059,'MAHARASHTRA',5000.00);

-- INSERT INTO PRODUCT MASTER
INSERT INTO PRODUCT_MASTER VALUES('P1','VEGETABLE',100,100,102);
INSERT INTO PRODUCT_MASTER VALUES('P2','FRUIT',20,20,20.3);
INSERT INTO PRODUCT_MASTER VALUES('P3','ELECTRONICS',200,200,200.1);
INSERT INTO PRODUCT_MASTER VALUES('P4','ELECTRONICS',30,30,30.4);
INSERT INTO PRODUCT_MASTER VALUES('P5','SERVICE',40,40,40.5);

-- INSERT INTO SALESMAN_MASTER
INSERT INTO SALESMAN_MASTER VALUES('S1','RAMU','KOLKATA',700059,'WEST BENGAL',2000.90);
INSERT INTO SALESMAN_MASTER VALUES('S2','UPAL','MUMBAI',700002,'MAHARASHTRA',1000.90);
INSERT INTO SALESMAN_MASTER VALUES('S3','SHYAM','BANGALORE',900059,'MAHARASHTRA',3000.90);
INSERT INTO SALESMAN_MASTER VALUES('S4','JADU','NOIDA',700078,'UTTARPRADESH',4000.90);
INSERT INTO SALESMAN_MASTER VALUES('S5','MODHU','KOLKATA',700059,'WEST BENGAL',5000.90);

-- INSERT INTO SALES ORDER
INSERT INTO SALES_ORDER (ORDER_NO, CLIENT_NO, ORDER_DATE, SALESMAN_NO) VALUES ('O001', 'C1', TO_DATE('2024-03-13', 'YYYY-MM-DD'), 'S1');
INSERT INTO SALES_ORDER (ORDER_NO, CLIENT_NO, ORDER_DATE, SALESMAN_NO, DELY_TYPE, DELY_DATE) VALUES ('O002', 'C2', TO_DATE('2024-03-14', 'YYYY-MM-DD'), 'S2', 'E', TO_DATE('2024-03-18', 'YYYY-MM-DD'));
INSERT INTO SALES_ORDER (ORDER_NO, CLIENT_NO, ORDER_DATE, SALESMAN_NO) VALUES ('O003', 'C3', TO_DATE('2024-03-15', 'YYYY-MM-DD'), 'S1');
INSERT INTO SALES_ORDER (ORDER_NO, CLIENT_NO, ORDER_DATE, SALESMAN_NO, DELY_TYPE, DELY_DATE) VALUES ('O004', 'C4', TO_DATE('2024-03-16', 'YYYY-MM-DD'), 'S3', 'E', TO_DATE('2024-03-20', 'YYYY-MM-DD'));
INSERT INTO SALES_ORDER (ORDER_NO, CLIENT_NO, ORDER_DATE, SALESMAN_NO) VALUES ('O005', 'C5', TO_DATE('2024-03-17', 'YYYY-MM-DD'), 'S2');

-- INSERT INTO SALES ORDER DETAILS
INSERT INTO SALES_ORDER_DETAILS (ORDER_NO, PRODUCT_NO, QTY_DISP, PRODUCT_RATE) VALUES ('O001', 'P1', 5, 100.00);
INSERT INTO SALES_ORDER_DETAILS (ORDER_NO, PRODUCT_NO, QTY_DISP, PRODUCT_RATE) VALUES ('O002', 'P2', 10, 20.30);
INSERT INTO SALES_ORDER_DETAILS (ORDER_NO, PRODUCT_NO, QTY_DISP, PRODUCT_RATE) VALUES ('O003', 'P3', 2, 200.10);
INSERT INTO SALES_ORDER_DETAILS (ORDER_NO, PRODUCT_NO, QTY_DISP, PRODUCT_RATE) VALUES ('O004', 'P4', 3, 30.40);
INSERT INTO SALES_ORDER_DETAILS (ORDER_NO, PRODUCT_NO, QTY_DISP, PRODUCT_RATE) VALUES ('O005', 'P5', 4, 40.50);

/*
III)
	Exercise on retrieving records from a table: 
	
	i.    Find out the names of all client master. 
	ii.   Retrieve the entire contents of the Client_Master table. 
	iii.  Retrieve the list of names, city and state of all client master. 
	iv.   List the various products available from the Product_Master table. 
	v.    List all clients who are located in Mumbai. 
	vi.   Find the names of salesman who have a salary equal to 3000. 
	vii.  Show the details of Product_Master according to Cost_Price in descending order. 
	viii. Show different types of salary amounts of the salesman. 
	ix.   Show only unique product details. 

*/
SELECT NAME FROM CLIENT_MASTER;
SELECT NAME, CITY, STATE FROM CLIENT_MASTER;
SELECT DESCRIPTION FROM PRODUCT_MASTER;
SELECT * FROM CLIENT_MASTER WHERE CITY = 'MUMBAI';
SELECT SALESMAN_NAME FROM SALESMAN_MASTER WHERE SAL_AMT = 3000;
SELECT * FROM PRODUCT_MASTER ORDER BY COST_PRICE DESC;
SELECT DISTINCT SAL_AMT FROM SALESMAN_MASTER;
SELECT DISTINCT * FROM PRODUCT_MASTER;

/*
IV)
	Exercise on updating records in a table: 
	i.   Change the city of client no ‘C001’ to ‘Bangalore’. 
	ii.  Change the BalDue of client no ‘C006’ to Rs. 1000. 
	iii. Change the cost price of ‘Trousers’ to Rs. 950.00. 
	iv.  Change the city of the salesman to ‘Pune’. 
*/
UPDATE CLIENT_MASTER SET CITY = 'Bangalore' WHERE CLIENT_NO = 'C1';
UPDATE CLIENT_MASTER SET BAL_DUE = 1000 WHERE CLIENT_NO = 'C6';
SELECT * FROM CLIENT_MASTER;

UPDATE PRODUCT_MASTER SET DESCRIPTION = 'Trousers' WHERE PRODUCT_NO = 'P1';
UPDATE PRODUCT_MASTER SET COST_PRICE = 950.00 WHERE DESCRIPTION = 'Trousers';
SELECT * FROM PRODUCT_MASTER;

UPDATE SALESMAN_MASTER SET CITY = 'Pune';
SELECT * FROM SALESMAN_MASTER;

/*
V)
	i.    Add a column called ‘Telephone’ of data type number and size = 10 to the Client_Master table. 
	ii.   Change the size of Sell_Price column in Product_Master to 10, 2. 
	iii.  Drop the column Cost_Price from Product_Master. 
	iv.   Delete all salesmen from the Salesman_Master whose salaries are equal to Rs. 3500. 
	v.    Delete all products from Product_Master where the quantity on hand is equal to 100. 
	vi.   Delete from Client_Master where the column state holds the value ‘Tamil Nadu’. 
	vii.  Change the name of the Salesman_Master table to Sman_Mast. 
	viii. Destroy the table Client_Master along with its data.
*/
ALTER TABLE CLIENT_MASTER ADD Telephone NUMBER(10);
ALTER TABLE PRODUCT_MASTER MODIFY Sell_Price NUMBER(10,2);
ALTER TABLE PRODUCT_MASTER DROP COLUMN Cost_Price;

DELETE FROM SALESMAN_MASTER WHERE SAL_AMT = 3500;
DELETE FROM PRODUCT_MASTER WHERE QTY_ON_HAND = 100;

DELETE FROM CLIENT_MASTER WHERE state = 'Tamil Nadu';
ALTER TABLE SALESMAN_MASTER RENAME TO Sman_Mast;

-- IF DROP NOT POSSIBLE GET THE CONSTRAINT NAME AND ALTER THE CHILD TABLE
SELECT CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE TABLE_NAME = 'SALES_ORDER' AND (R_CONSTRAINT_NAME IN (SELECT CONSTRAINT_NAME FROM USER_CONSTRAINTS WHERE TABLE_NAME = 'CLIENT_MASTER'));
ALTER TABLE SALES_ORDER DROP CONSTRAINT <constraint_name>;
-- THEN DROP
DROP TABLE CLIENT_MASTER;

